# Author: Knightsbr1dge
# Web: https://www.knightsbr1dge.red
# Social: "Knightrsbr1dge" on IG and Twitter

# This PowerShell script will set up a new training domain

#Set Params
Param(
    [String]$NetBIOS,
    [String]$DomainName,
    [SecureString]$Password
)

# Get the domain name from the user
Write-Warning "This script will build a domain for testing and lab purposes"
Write-Warning "DO NOT use this script to create a production domain" 
$DomainName = Read-Host "Please enter a valid domain name (e.g CONTOSO.LAB)"

# Check the 

# Set the NetBIOS variable
$NetBIOS=$DomainName.split('.')[0].split('.')

# Set the administrative password
$Password='Passw0rd1!'

# Add AD DS to the Server
Install-WindowsFeature AD-Domain-Services -IncludeManagementTools -IncludeAllSubFeature

# Set local admin password
net user Administrator $Password

# Install new forest
Import-Module ADDSDeployment
Install-ADDSForest `
-SkipPreChecks `
-CreateDnsDelegation:$false `
-DatabasePath "C:\Windows\NTDS" `
-DomainMode "WinThreshold" `
-DomainName $DomainName `
-DomainNetbiosName $NetBIOS `
-ForestMode "WinThreshold" `
-InstallDns:$true `
-LogPath "C:\Windows\NTDS" `
-NoRebootOnCompletion:$True `
-SysvolPath "C:\Windows\SYSVOL" `
-SafeModeAdministratorPassword $Password `
-Force:$true

# Reboot
Restart-Computer -force

